 devops-netology

# Домашнее задание к занятию "3.6. Компьютерные сети, лекция 1"

### 2. Узнайте о том, сколько действительно независимых (не пересекающихся) каналов есть в разделяемой среде WiFi при работе на 2.4 ГГц. Стандарты с полосой 5 ГГц более актуальны, но регламенты на 5 ГГц существенно различаются в разных странах, а так же не раз обновлялись. В качестве дополнительного вопроса вне зачета, попробуйте найти актуальный ответ и на этот вопрос.
   Диапазон частот 2,4 ГГц соответствует международному стандарту ISM. Разрешенный в России диапазон включает 13 каналов из 14 (14-й разрешено использовать только в Японии) шириной в 20 МГц.
   Не перекающимися каналами являются каналы 1-й, 6-й и 11-й. ФОрмально, в России можно считать не перекающимися и каналы 2-7-12 и 3-8-1, но в большинстве стран в этом диапазон доступны только 
   11 каналов, поэтому действительно независимыми можно считать набор 1-6-11. При использовании полосы в 40 Мгц на канал, о не пресекающихся каналах можно говорить чисто условно, например,
   широкие каналы 5+9 или 4+8 эффективно будут ставить помехи по всей ширине диапазона.
   5 ГГц - это не единый диапазон частот, а ряд диапазонов. Выделяемые для нелицензируемой работы полосы частот называются UNII (Нелицензируемая национальная информационная инфраструктура).
   Частотная сетка диапазона предусматривает использования для Wi-Fi только непересекающихся каналов шириной 20 МГц и с шагом 20 МГц, от начала и конца полосы частотный отступ составляет 30 МГц.
   Первоначально были разрешены к использованию полосы UNII-1 (Европа, Россия) и дополнительно к ней UNII-3 и один канал из "медицинского" ISM (США), позднее к ним добавили полосу UNII-2.
   Диапазон содержит 25 непересекающихся каналов. Частотные полосы UNII-2 и UNII-2 Extended выделенные для Wi-Fi пересекаются с частотами, на которых работают авиационные, судовые и военные радары,
   а также погодные радары аэродромов.
   В России на текущий момент времени из диапазона UNII-2 Extended разрешено использование только четырех каналов 132-144, таким образом у нас доступно всего 17 непересекающихся каналов,
   по четыре в каждой из полос UNII и один в ISM
   Кроме стандартной ширины канала в 20 МГц стандартами Wi-Fi предусмотрено использование каналов шириной в 40 МГц, 80 МГц и 160 МГц. Широкие полосы могут использоваться только в полосах UNII.
   Таким образом каждая из доступных в России полос может содержать по 4 канала 20 МГц, 2 канала 40 МГц и по одному каналу 80 МГц. Канал шириной в 160 МГц может использоваться только один,
   получаемый при объединении полос UNII-1 и UNII-2 - занимая всю их ширину.

### 3. Адрес канального уровня – MAC адрес – это 6 байт, первые 3 из которых называются OUI – Organizationally Unique Identifier или уникальный идентификатор организации. Какому производителю принадлежит MAC `38:f9:d3:55:55:79`?
   Скачиваем базу с  OUI
```
wget http://standards-oui.ieee.org/oui/oui.txt
```
   Находим производителя, которому принадлежит MAC-адрес в задании
```
vagrant@vagrant:~/devops-netology$ grep -i 38f9d3 oui.txt 
38F9D3     (base 16)            Apple, Inc.
vagrant@vagrant:~/devops-netology$ 
```
   Этот mac-адрес принадлежит компании Apple


### 4. Каким будет payload TCP сегмента, если Ethernet MTU задан в 9001 байт, размер заголовков IPv4 – 20 байт, а TCP – 32 байта?
   Максимальный размер payload TCP (MSS) = MTU − размер заголовка IP − размер заголовка TCP, соотвественно в данном случае MSS будет равен *8949*

### 5. Может ли во флагах TCP одновременно быть установлены флаги SYN и FIN при штатном режиме работы сети? Почему да или нет?
   Нет, флаги SYN и FIN не могут быть установленны одновременно, так как флаг SYN указывает на начало соединения, а флаг FYN указывает на завершение соединения.

### 6. `ss -ula sport = :53` на хосте имеет следующий вывод:

```bash
State           Recv-Q          Send-Q                   Local Address:Port                     Peer Address:Port          Process
UNCONN          0               0                        127.0.0.53%lo:domain                        0.0.0.0:*
```
Почему в `State` присутствует только `UNCONN`, и может ли там присутствовать, например, `TIME-WAIT`?

   Состояние UNCONN - это значит *отключен*, так как этот порт ничем не используется.  В данном выводе *TIME-WAIT* присутствовать не может, так как мы используем ключ *-u*, а это значит,
   выводится информация для udp-сокетов, а  состояние *TIME-WAIT* может быть только у tcp-сокета. Оно означает, что узел-инициатор получил сегмент с флагом FIN, отправил сегмент с флагом ACK и 
   ждёт 2*MSL секунд, перед окончательным закрытием соединения. 

### 7. Обладая знаниями о том, как штатным образом завершается соединение (FIN от инициатора, FIN-ACK от ответчика, ACK от инициатора), опишите в каких состояниях будет находиться TCP соединение в каждый момент времени на клиенте и на сервере при завершении. Схема переходов состояния соединения вам в этом поможет.
|Клиент| |Сервер| |
|------|-|------|-|
Начальное состояние|Переход в состояние|Начальное состояние|Переход в состояние
-------------------|-------------------|-------------------|-------------------
ESTABLISHED|FIN-WAIT-1|ESTABLISHED| |
FIN-WAIT-1| |ESTABLISHED|CLOSE-WAIT
FIN-WAIT-1|FIN-WAIT-2|CLOSE-WAIT| |
FIN-WAIT-2| |CLOSE-WAIT|LAST-ACK
FIN-WAIT-2| |LAST-ACK| |TIME-WAIT| |LAST-ACK|CLOSED
TIME-WAIT|CLOSED|CLOSED| |
CLOSED| |CLOSED| |

### 7. TCP порт – 16 битное число. Предположим, 2 находящихся в одной сети хоста устанавливают между собой соединения. Каким будет теоретическое максимальное число соединений, ограниченное только лишь параметрами L4, которое параллельно может установить клиент с одного IP адреса к серверу с одним IP адресом? Сколько соединений сможет обслужить сервер от одного клиента? А если клиентов больше одного?
   Так как TCP-порт шестнадцатибитное число, значит максимальное количество портов составляет *65535* - это и будет максимальное количество соединений.
   Количество портов на сервере будет регулироваться значением 'net.ipv4.ip_local_port_range = 32768    60999'. Данный параметр указывает диапазон используемых портов клиентскими приложениями, 
   т. е. начало и конец диапазона. Диапазон ограничивается наличием памяти на хосте, чем больший объем памяти имеется у хоста, тем больший диапазон портов можно задать.   

### 8. Может ли сложиться ситуация, при которой большое число соединений TCP на хосте находятся в состоянии  `TIME-WAIT`? Если да, то является ли она хорошей или плохой? Подкрепите свой ответ пояснением той или иной оценки.
   Состояние TIME-WAIT наступает в ходе разрыва соединения. Активная сторона отправляет последний пакет в сессии (ACK на пассивный FIN). Поскольку она не может узнать получен ли этот пакет,
   для неё предусмотрен статус TIME_WAIT. В данном состоянии соединение должно находиться время 2 * MSL (максимальное время жизни пакета). Ситуация при которой большое число соединений на хосте
   наодятся в состоянии `TIME-WAIT` может сложиться, если соединения клиентом устанавливаются быстрее, чем порты выходят из карантина, то есть остаются в состоянии TIME_WAIT.
   Очередь TIME_WAIT будет расти, забирая системные ресурсы.
 
### 9. Чем особенно плоха фрагментация UDP относительно фрагментации TCP?
   Протокол UDP в отличии от протокола TCP не имеет механизма подтверждения получения пакетов и механизма переупорядочения, то есть если потеряется дефрагментированный пакет 
   или пакеты придут не в том порядке, то исходные данные будут потеряны. 

### 10. Если бы вы строили систему удаленного сбора логов, то есть систему, в которой несколько хостов отправяют на центральный узел генерируемые приложениями логи (предположим, что логи – текстовая информация), какой протокол транспортного уровня вы выбрали бы и почему? Проверьте ваше предположение самостоятельно, узнав о стандартном протоколе syslog.
   Я бы использовал протокол TCP, так как он гарантирует доставку пакетов.
   *syslog* может работать и по UDP и по TCP, работа через TCP была стандртизована в 2012 RFC6587 (Transmission of Syslog Messages over TCP). 

### 11. Сколько портов TCP находится в состоянии прослушивания на вашей виртуальной машине с Ubuntu, и каким процессам они принадлежат?
```
vagrant@vagrant:~/devops-netology$ sudo sudo ss -tlap
State            Recv-Q           Send-Q                     Local Address:Port                         Peer Address:Port            Process                                                             
LISTEN           0                4096                       127.0.0.53%lo:domain                            0.0.0.0:*                users:(("systemd-resolve",pid=724,fd=13))                          
LISTEN           0                128                              0.0.0.0:ssh                               0.0.0.0:*                users:(("sshd",pid=812,fd=3))                                      
LISTEN           0                4096                             0.0.0.0:sunrpc                            0.0.0.0:*                users:(("rpcbind",pid=723,fd=4),("systemd",pid=1,fd=35))           
ESTAB            0                0                              10.0.2.15:ssh                              10.0.2.2:58296            users:(("sshd",pid=1042,fd=4),("sshd",pid=1005,fd=4))              
LISTEN           0                128                                 [::]:ssh                                  [::]:*                users:(("sshd",pid=812,fd=4))                                      
LISTEN           0                4096                                [::]:sunrpc                               [::]:*                users:(("rpcbind",pid=723,fd=6),("systemd",pid=1,fd=37))           
vagrant@vagrant:~/devops-netology$
```
   В режиме прослушивания находится 5 портов. Они принадлежат процессам *systemd*, *sshd*. 

### 12. Какой ключ нужно добавить в `tcpdump`, чтобы он начал выводить не только заголовки, но и содержимое фреймов в текстовом виде? А в текстовом и шестнадцатиричном?
   С ключом -A `tcpdump` будет выводить данные в текстовом виде. 

```
vagrant@vagrant:~/devops-netology$ sudo tcpdump -A -c 1
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 262144 bytes
18:55:17.942111 IP vagrant.ssh > _gateway.58296: Flags [P.], seq 1693676816:1693677056, ack 2872876, win 65535, length 240
E.....@.@..*
...
.......d.u..+.,P.......Z.....Ium5a.;Mm4...V.u.0.?..
......z....b.P...B.fQ..G...g....u.-@.U.4....N..s.s..M+........f....*}.....r).C.$G.'..\.R.................dh}..eR"2..a.c.        g.....<5./....R.6.u.J.U.l.4....V..l..+p...S...!..]......H.."To1..g....$.m..      ...zk.U.......
1 packet captured
10 packets received by filter
0 packets dropped by kernel
```
   С ключом -XX `tcpdump` будет выводить пакеты и заголовки канального уровня  в ASCII- и hex-формате.
```
vagrant@vagrant:~/devops-netology$ sudo tcpdump -XX -c 1
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 262144 bytes
18:55:23.041931 IP vagrant.ssh > _gateway.58296: Flags [P.], seq 1693678848:1693679088, ack 2873836, win 65535, length 240
        0x0000:  5254 0012 3502 0800 27e3 90c5 0800 4510  RT..5...'.....E.
        0x0010:  0118 85a3 4000 4006 9c1c 0a00 020f 0a00  ....@.@.........
        0x0020:  0202 0016 e3b8 64f3 7d00 002b d9ec 5018  ......d.}..+..P.
        0x0030:  ffff 191b 0000 7253 2de2 579b 5316 a073  ......rS-.W.S..s
        0x0040:  f4da f22c 176f 211a e7a3 923d 892e 99d1  ...,.o!....=....
        0x0050:  2b59 770d ca8c c113 eca8 1160 7184 1f1a  +Yw........`q...
        0x0060:  d769 a5b4 e64f b111 cdbb 78b5 0b4f ec86  .i...O....x..O..
        0x0070:  4a67 3bfa 1ac4 6a66 5541 3b6a 2940 b304  Jg;...jfUA;j)@..
        0x0080:  c37d 55f7 669d e7e0 c6e5 79c2 8e44 3695  .}U.f.....y..D6.
        0x0090:  35bf 2db5 e9bc 989f ed0c 0183 0bbd 20d0  5.-.............
        0x00a0:  39b7 c0a2 a722 d0a8 f87d cac7 e7f4 7f62  9...."...}.....b
        0x00b0:  46bd 1dd4 67d6 bde0 fe22 16f6 8aeb a5b4  F...g...."......
        0x00c0:  a787 eca7 f7c1 d2ec 8116 7e28 b12b da6a  ..........~(.+.j
        0x00d0:  3ad2 8024 89c5 4b30 0320 d39b 9f7f c40e  :..$..K0........
        0x00e0:  e005 9068 a8db 94e9 bb49 90b5 d35a 3993  ...h.....I...Z9.
        0x00f0:  0b93 943d b303 47da a81f 8f59 f008 c75d  ...=..G....Y...]
        0x0100:  da95 f18f 0e8d 95bd cc51 fce2 92e7 fc90  .........Q......
        0x0110:  9a07 291b a058 bc39 ea7f 433b 3e82 1021  ..)..X.9..C;>..!
        0x0120:  68eb 7086 3ca8                           h.p.<.
1 packet captured
14 packets received by filter
0 packets dropped by kernel
vagrant@vagrant:~/devops-netology$
```
### 13. Попробуйте собрать дамп трафика с помощью `tcpdump` на основном интерфейсе вашей виртуальной машины и посмотреть его через tshark или Wireshark (можно ограничить число пакетов `-c 100`). Встретились ли вам какие-то установленные флаги Internet Protocol (не флаги TCP, а флаги IP)? Узнайте, какие флаги бывают. Как на самом деле называется стандарт Ethernet, фреймы которого попали в ваш дамп? Можно ли где-то в дампе увидеть OUI?
   Собираем трафик в файл
```
vagrant@vagrant:~/devops-netology$ sudo tcpdump -i eth0 -c 100 -w tcpdump.pcap
tcpdump: listening on eth0, link-type EN10MB (Ethernet), capture size 262144 bytes
100 packets captured
101 packets received by filter
0 packets dropped by kernel
vagrant@vagrant:~/devops-netology$ 
```
   Встречаются флаги IP
```
Flags: 0x40, Don't fragment
   0... .... = Reserved bit: Not set
   .1.. .... = Don't fragment: Set
   ..0. .... = More fragments: Not set
```
   Этот флаг запрещает разбивку пакета на фрагменты.
   Стандарт Ethernet называется Ethernet II.
   В дампе можно увидеть OUI в заголовке пакета в поле Destination, например
```
Ethernet II, Src: PcsCompu_e3:90:c5 (08:00:27:e3:90:c5), Dst: RealtekU_12:35:02 (52:54:00:12:35:02)
   Destination: RealtekU_12:35:02 (52:54:00:12:35:02)
```

 
 ---

### Как оформить ДЗ?

Домашнее задание выполните в файле readme.md в github репозитории. В личном кабинете отправьте на проверку ссылку на .md-файл в вашем репозитории.

Также вы можете выполнить задание в [Google Docs](https://docs.google.com/document/u/0/?tgif=d) и отправить в личном кабинете на проверку ссылку на ваш документ.
Название файла Google Docs должно содержать номер лекции и фамилию студента. Пример названия: "1.1. Введение в DevOps — Сусанна Алиева"
Перед тем как выслать ссылку, убедитесь, что ее содержимое не является приватным (открыто на комментирование всем, у кого есть ссылка). 
Если необходимо прикрепить дополнительные ссылки, просто добавьте их в свой Google Docs.

Любые вопросы по решению задач задавайте в чате Slack.

---


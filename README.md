 devops-netology

# Домашнее задание к занятию "3.7. Компьютерные сети, лекция 2"

###1. На лекции мы обсудили, что манипулировать размером окна необходимо для эффективного наполнения приемного буфера участников TCP сессии (Flow Control). Подобная проблема в полной мере возникает в сетях с высоким RTT. Например, если вы захотите передать 500 Гб бэкап из региона Юга-Восточной Азии на Восточное побережье США. [Здесь](https://www.cloudping.co/grid) вы можете увидеть и 200 и 400 мс вполне реального RTT. Подсчитайте, какого размера нужно окно TCP чтобы наполнить 1 Гбит/с канал при 300 мс RTT (берем простую ситуацию без потери пакетов). Можно воспользоваться готовым [калькулятором](https://www.switch.ch/network/tools/tcp_throughput/). Ознакомиться с [формулами](https://en.wikipedia.org/wiki/TCP_tuning), по которым работает калькулятор можно, например, на Wiki.
   Для расчёта максимального размера окна (т.е. максимальный объем данных, которые могут передаваться одним пользователем другому в канале связи) рассчитывается по формуле:
   *Полоса пропускания (бит/сек) x RTT (круговое время передачи по сети) = размер окна в битах*
   Для нашего примера получится (1 000 000 000 x 0,3)/8 = 37 500 КБайт 

###2. Во сколько раз упадет пропускная способность канала, если будет 1% потерь пакетов при передаче?
   Рассчитать во-сколько раз упадет пропускная способность можно с помощью уравнения Матиса *Максимальная скорость в бит/с = (MSS/RTT) × (1/квадратный корень (p))*, где p - вероятность потери пакета.
   Согласно стандарту IEEE 802.3ab приемлемым для 1000BaseT коэффициентом битовых ошибок (BER) считается одна ошибка на 1010 битов. Имходя из этого расчитаем скорость без потерь,
   приняв процент потерь равным 0,0001 %, размер MSS 1460 и RTT 0,02 м/с.
```Cкорость в бит/с = (1460/0,002) × (1/квадратный корень (0,000001))
   Cкорость в бит/с = 730 Мбит/с
```
   Теперь посчитаме максимальную скорость если потери составят 1%, при этом значении величина вероятности потери пакета составит - 0,01
```
Cкорость в бит/с = (1460/0,002) × (1/квадратный корень (0,01))
Cкорость в бит/с = 7,3 Мбит/с
```
   Вывод - при потерях в 1% пропускная способность сети упадет в 100 раз. 

###3. Какая  максимальная реальная скорость передачи данных достижима при линке 100 Мбит/с? Вопрос про TCP payload, то есть цифры, которые вы реально увидите в операционной системе в тестах или в браузере при скачивании файлов. Повлияет ли размер фрейма на это?
   Как мы знаем Ethernet-кадр помимо MSS включает в себя *Ethernet заголовок/FCS – 26 байт, IFG(межкадровое пространство) – 12 байт, IP заголовок – 20 байт, TCP заголовок – 20 байт*.
   Зная это и беря размер MTU 1500 байт мы можем посчитатьт TCP payload:
```Max TCP Payload= (MTU–TCP–IP) / (MTU+Ethernet+IFG) = (1500–40) / (1500+26+12) = 94.9 %```
   Значит максимальная реальная скорость передачи данных при линке 100 Мбит/с составит 94,9 Мбит/с. При изменении размера фрейма, скорость будет меняться прямо пропорционально, так как будет изменяться
   и количество служебной информации.

###4. Что на самом деле происходит, когда вы открываете сайт? :)
###На прошлой лекции был приведен сокращенный вариант ответа на этот вопрос. Теперь вы знаете намного больше, в частности про IP адресацию, DNS и т.д.
###Опишите максимально подробно насколько вы это можете сделать, что происходит, когда вы делаете запрос `curl -I http://netology.ru` с вашей рабочей станции. Предположим, что arp кеш очищен, в локальном DNS нет закешированных записей.
   1. Создание файлового дескриптора системным вызовом socket (тип AF_INET то есть IPv4, тип сокета - для дейтаграммной передачи)
   2. Установка опций созданного сокета.
   3. Вызов системного вызова connect для подключения к 53 порту по адресу 127.0.0.53 (этот адрес используетс ка заглушка на которой можно присылать DNS запросы)
   4. Отправка DNS запроса 
   5. Получение IP-адреса 104.22.48.171 соответствующего netology.ru
   6. Создание сокета (тип AF_INET, тип сокета - для потоковой передачи, тип сокета TCP, устанавливается параметром IPPROTO_TCP)
   7. Установка параметров сокета (NODELAY, KEEPALIVE, KEEIDLE, KEEPINTVL)
   8. Вызов системного вызова connect для подключения к 80 порту по адресу 104.22.48.171.
   9. От клиента к серверу - запрос/установка соединения к хосту по порту 80 (SYN)
   10. От сервера к клиенту - Открытие/подтверждение соединения (SYN, ACK)
   11. От клиента к серверу - подтверждение (ACK)
   12. От клиента к серверу - Отправка запроса HEAD (системный вызов sendto отправляет запрос HEAD / HTTP/1.1)
   13. От сервера к клиенту - подтверждение (ACK)
   14. От сервера к клиенту - сообщение HTTP/1.1 301 Moved Permanently (на клиенте системный вызов recvfrom)
   15. От клиента к серверу - подтверждение (ACK)
   16. От клиента к серверу - запрос на закрытие саодинения (FIN, ACK)
   17. От сервера к клиенту - подтверждение (ACK)
   18. От сервера к клиенту - подтверждение закрытия (FIN, ACK)
   19. От клиента к серверу - подтверждение (ACK)  

###5. Сколько и каких итеративных запросов будет сделано при резолве домена `www.google.co.uk`?
   При резолве домена будет сделано 3 итеративных запроса.
   1. Запрос корневому серверу.
   2. Запрос серверу обслуживающему зону .uk.
   3. Запрос серверу обслуживающему зону .google.com.
   Это хорошо видно при выполнении команды *dig +trace -A www.google.co.uk*
```vagrant@vagrant:~/devops-netology$ dig +trace A www.google.co.uk

; <<>> DiG 9.16.1-Ubuntu <<>> +trace A www.google.co.uk
;; global options: +cmd
.                       7098    IN      NS      k.root-servers.net.
.                       7098    IN      NS      a.root-servers.net.
.                       7098    IN      NS      d.root-servers.net.
.                       7098    IN      NS      c.root-servers.net.
.                       7098    IN      NS      f.root-servers.net.
.                       7098    IN      NS      m.root-servers.net.
.                       7098    IN      NS      h.root-servers.net.
.                       7098    IN      NS      i.root-servers.net.
.                       7098    IN      NS      l.root-servers.net.
.                       7098    IN      NS      g.root-servers.net.
.                       7098    IN      NS      b.root-servers.net.
.                       7098    IN      NS      j.root-servers.net.
.                       7098    IN      NS      e.root-servers.net.
;; Received 262 bytes from 127.0.0.53#53(127.0.0.53) in 0 ms

uk.                     172800  IN      NS      dns1.nic.uk.
uk.                     172800  IN      NS      dns4.nic.uk.
uk.                     172800  IN      NS      nsa.nic.uk.
uk.                     172800  IN      NS      nsd.nic.uk.
uk.                     172800  IN      NS      nsc.nic.uk.
uk.                     172800  IN      NS      nsb.nic.uk.
uk.                     172800  IN      NS      dns3.nic.uk.
uk.                     172800  IN      NS      dns2.nic.uk.
uk.                     86400   IN      DS      43876 8 2 A107ED2AC1BD14D924173BC7E827A1153582072394F9272BA37E2353 BC659603
uk.                     86400   IN      RRSIG   DS 8 1 86400 20210724050000 20210711040000 26838 . BfRM+l/ME3LTTptqB/Wj4mqzuXdpOHbhFv/Zb3h44bCL1+5jsKreCfqx z68d6zyjZE7MiiGKc65NumG5D5a4tsyCX33hALqmeSyC409Yybt+NNaK MGfjkYQpYVpCguFUeWaPA8AIwRkCZYmdaOx1Zcyu1X0y5i85Q01ZDGg2 cfurH6poprQyHX164PIXEa+0z2Om8drR4pE5sG87RgzL7Q5WK4bSfxTl zV7LTKcYRzfsMP/pI/mS574SiEX81f770fkThWg/P+Mw21xynGpCto4o HnfeTFnp+ylLGkJvaxyoB9rhYkxZbndQB8JP5f1TtBypqoVLHW/jB0oz 42AYxg==
;; Received 800 bytes from 198.41.0.4#53(a.root-servers.net) in 68 ms

google.co.uk.           172800  IN      NS      ns3.google.com.
google.co.uk.           172800  IN      NS      ns1.google.com.
google.co.uk.           172800  IN      NS      ns2.google.com.
google.co.uk.           172800  IN      NS      ns4.google.com.
G9F1KIIHM8M9VHJK7LRVETBQCEOGJIQP.co.uk. 10800 IN NSEC3 1 1 0 - G9F5O8Q1LBTUKBV4FRD3PU0HUIPAP422 NS SOA RRSIG DNSKEY NSEC3PARAM TYPE65534
G9F1KIIHM8M9VHJK7LRVETBQCEOGJIQP.co.uk. 10800 IN RRSIG NSEC3 8 3 10800 20210811073752 20210707065809 33621 co.uk. QY+igz4QzQZs1Z0Ev4QKC5uDHOGavqgWrLxiiBQs996mWNFO9AfMVo88 ukEQh4u2LwAP//DcewI4u0pzBWNaV6NfYCl/HRNlkgCBTlMKnLvNbudw IU7fKTu+4UIyNtHSuonmRg5UxUsF2ronCq5P+AuuEpE8OuOwxyGTlcuq ERk=
6QEK9GOTC8RL190U20RPPM84PHAACO0T.co.uk. 10800 IN NSEC3 1 1 0 - 6QF16S089GRU386I3JOL1T2E5CV61060 NS DS RRSIG
6QEK9GOTC8RL190U20RPPM84PHAACO0T.co.uk. 10800 IN RRSIG NSEC3 8 3 10800 20210814193412 20210710191552 33621 co.uk. MobKiHIGJ+2QaW49HIskBfAV81l3s/7VS/fptt3nTatZbGIkpHi/d824 4XgbIM4zBTzqYkoqLw0iDEuUsBDNIx1PipFVffnyAbVxcA3SkaSFY8L/ uWADPDUKL5pKUghnGFshmbv42mbuNMjbtr6yTQkXQyIs1itTM7WsYjgc MSE=
;; Received 678 bytes from 156.154.100.3#53(nsa.nic.uk) in 76 ms

www.google.co.uk.       300     IN      A       142.251.1.94
;; Received 61 bytes from 216.239.36.10#53(ns3.google.com) in 44 ms

vagrant@vagrant:~/devops-netology$
```

###6. Сколько доступно для назначения хостам адресов в подсети `/25`? А в подсети с маской `255.248.0.0`. Постарайтесь потренироваться в ручных вычислениях чтобы немного набить руку, не пользоваться калькулятором сразу.
   В сети /25 зостам доступно 2 в степени 7 = 128 - 2 или 126 хостов, адреса с 0 и 255 в последнем октете хостам не назначаются и являются id сети и broadcast-адресом.
   В подсети с маской 255.248.0.0 для хостовой отчасти используется 3+8+8=19 бит. 2 в 19 степени - 524288 адреса, значит для нахзначения хостам в подсети с маской 255.248.0.0 доступно 524286 адресов.

###7. В какой подсети больше адресов, в `/23` или `/24`?
   Больше адресов в подсети /23. В подсети /23 - 2 в 9 степени = 512 адресов, в подести /24 - 2 в 8 степени = 256 адресов.

###8. Получится ли разделить диапазон `10.0.0.0/8` на 128 подсетей по 131070 адресов в каждой? Какая маска будет у таких подсетей?
   Да, получится (если речь идет о 131072 адресов или 131070 хостов в каждой сети).
   10.0.0.0/8 - это маска 24 бита. 2 в 24 степени = 16777216 адресов. 16777216/131072=128 подсетей. 128 это 2 в 7 степени. 7 битовая хостовая часть это /15. Значит маска новых подсетей будет /15. 
